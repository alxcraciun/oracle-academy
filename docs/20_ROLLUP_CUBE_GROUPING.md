# ROLLUP & CUBE & GROUPING

## Rollup

- used to produce subtotals and totals of groups
- uses an ordered list of grouping columns as argument

<br>

```sql
select department_id, job_id, sum(salary)
from employees
where departmet_id < 50
group by ROLLUP(department_id, job_id);
```

<br>

| DEPARTMENT_ID | JOB_ID  | SUM(SALARY) |
| ------------- | ------- | ----------- |
| 10            | AD_ASST | 4400        |
| 10            | -       | 4400        |
| 20            | MK_MAN  | 13 000      |
| 20            | MK_REP  | 6000        |
| 20            | -       | 19 000      |
| -             | -       | 23 400      |

<br>

**Yellow Rows:**

- Subtotal for dept_id = 10,
- Subtotal for dept_id = 20,
- Grand Total for report

<br>

***No. of columns passed as arguments + 1 = No. of rows listed** <br>
Rollup print rows based on number of columns passed as an argument. 

<br>

## Cube

- produces cross-tabulation reports
- can be applied to all group functions
- columns listed in `group by` are cross-referenced

<br>

```sql
select department_id, job_id, sum(salary)
from employees
where department_id < 50
group by CUBE(department_id, job_id)
```

<br>

| DEPARTMENT_ID | JOB_ID    | SUM(SALARY) |
| ------------- | --------- | ----------- |
| -             | -         | *23 400*    |
| -             | *MK_MAN*  | *13 000*    |
| -             | *MK_REP*  | *6000*      |
| -             | *AD_ASST* | *4400*      |
| *10*          | -         | *4400*      |
| 10            | AD_ASST   | 4400        |
| *20*          | -         | *19* 000    |
| 20            | MK_MAN    | 13 000      |
| 20            | MK_REP    | 6000        |

<br>

Italic values represent in order:
- Total for report
- Subtotal for MK_MAN
- Subtotal for MK_REP
- Subtotal for AD_ASST
- Subtotal for dept 10
- Subtotal for dept 20

<br>

## Grouping Sets

- used to specify multiple groupings of data
- allows you to have more `group by` clauses
- extremely efficient for writing complex reports

<br>

```sql
select department_id, job_id, manager_id, SUM(salary)
from employees
where department_id < 50
group by GROUPING SETS(
 
(job_id, manager_id), 

(department_id, job_id),

(department_id, manager_id)

);

```

<br>


| DEPARTMENT_ID | JOB_ID  | MANAGER_ID | SUM(SALARY) |
| ------------- | ------- | ---------- | ----------- |
| -             | MK_MAN  | 100        | 13 000      |
| -             | MK_MAN  | 201        | 6000        |
| -             | AD_ASST | 101        | 4400        |
| 10            | AD_ASST | -          | 4400        |
| 20            | MK_MAN  | -          | 13 000      |
| 20            | MK_REP  | -          | 6000        |
| 10            | -       | 101        | 19 000      |
| 20            | -       | 100        | 13 000      |
| 20            | -       | 201        | 6000        |

- Rows 1-3 are generated by first line
- Rows 4-6 are generated by first line
- Rows 7-9 are generated by first line

<br>

### Grouping Functions

- used only in the `select` clause and takes only a single argument
- returns `1` for an aggregated row and `0` for a non-aggregated row
- used to distinguish stores values from queries returned by ROLLUP & CUBE

<br>

```sql
select department_id, job_id, sum(salary)
GROUPING(Department_id) as "Dept sub total"
GROUPING(job_id) as "Job sub total"
from employees
where department_id < 50
group by CUBE(department_id, job_id)
```

<br>


| DEPARTMENT_ID | JOB_ID  | SUM(SALARY) | Dept sub total | Job sub total |
| ------------- | ------- | ----------- | -------------- | ------------- |
| -             | -       | 23 400      | 1              | 1             |
| -             | MK_MAN  | 13 000      | 1              | 0             |
| -             | MK_REP  | 6000        | 1              | 0             |
| -             | AD_ASST | 4400        | 1              | 0             |
| 10            | -       | 4400        | 0              | 1             |
| 10            | AD_ASST | 4400        | 0              | 0             |
| 20            | -       | 19 000      | 0              | 1             |
| 20            | MK_MAN  | 13 000      | 0              | 0             |
| 20            | MK_REP  | 6000        | 0              | 0             |